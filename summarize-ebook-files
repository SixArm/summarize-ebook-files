#!/bin/sh

##
# Summarize ebooks files in a given directory and subdirectories.
#
# This script generates AI agent files:
#
#  - plan.md: the high-level AI agent instructions
#  - tasks.md: the low-level list of each ebook file to process
#
# Syntax:
#
#     summarize-ebook-files.sh <directory>
#
# Example: 
#
#     summarize-ebook-files.sh ~/path/to/ebooks
#
# Output files:
#
#     plan.md
#     tasks.md
##

set -euf

cat << EOF > plan.md
Summarize ebook files.
- To find the files to process, run the command: bash(find . -type f -name '*.epub' -o -name '*.pdf' -execdir test ! -f index.md \; -print)
- Create each ebook summary as comprehensive (1-2 pages) with detailed breakdowns with key concepts, examples, and practical applications.
- An epub file is a zipped collection of HTML files; a pdf file is a fixed-layout document.
- You are authorized to use any program or method or library to read and summarize ebook files, such as unzip, untar, pandoc, PyMuPDF, ebooklib, etc.
- Use markdown formatting for the summary, including headings, subheadings, bullet points, and code blocks where appropriate.
- Save the summary to a file named "index.md" in the same directory as the ebook file. 
- Continue processing files until they are complete. Do not pause or wait for further instructions.
- If you get cut off by the message limit, or run out of tokens, then I will say "continue," and you will pick up where you left off. 
EOF

find $1 -type f -name '*.epub' -o -name '*.pdf' -execdir test ! -f index.md \; -print |
while read -r x; do 
    dir=$(dirname "$x")
    echo "- summarize the ebook file \"$x\" then save output to a file \"$dir/index.md\""
done > tasks.md
